# Service


* 서비스란?
    
  * Pod는 클러스터에서 실행 중인 컨테이너의 집합을 나타낸다. 때로는 이 패턴을 마이크로-서비스라고 한다.
  
  * Pod은 컨트롤러에 의해 관리되기 때문에 한 군데에 고정되어 있지 않고 클러스터 내를 옮겨다닌다.
  
  * 이 과정에서 노드를 옮기며 실행되기도 하고 포트 IP가 변경되기도 한다.
  
  * 이렇게 동적으로 변하는 Pod들에 고정된 방법으로 접근하기 위해 사용되는게 서비스이다.

  * 서비스를 사용하면 포드가 클러스터내의 어디에 있는지에 상관없이 고정된 주소를 이용해서 접근이 가능해진다.
  
  * 클러스터 외부에서 포드에 접근하는것도 서비스를 통해서 가능하다.
  
  * 서비스는 지정된 IP로 생성이 가능하고, 여러 Pod를 묶어서 로드 밸런싱이 가능하며, 고유한 DNS 이름을 가질 수 있다.

  * 여러 Pod에 같은 애플리케이션을 운용할 때 Pod간의 로드밸런싱을 지원해야 하는데, 이럴 때 서비스를 주로 사용한다.



### 서비스의 구성

서비스의 구성은 다음과 같다.

```
apiVersion: v1
kind: Service
metadata:
  name: hello-node-svc
spec:
  selector:
    app: hello-node
  ports:
    - port: 80
      protocol: TCP
      targetPort: 8080
  type: LoadBalancer
```

  * 해당 구성에서, name의 이름으로 새로운 서비스 오브젝트를 생성하고, app 레이블을 가진 Pod의  TCP 포트를 대상으로 한다.

  * 쿠버네티스는 이 서비스에 서비스 프록시가 사용하는 IP 주소를 할당한다. 

  * 라벨 셀렉터(label selector)를 이용하여, 관리하고자 하는 Pod 들을 정의할 수 있다. 

  * ports 부분에 추가적으로 포트 정보를 정의하여, 여러 개의 포트를 동시에 지원할 수 있다.
  
  * type으로 서비스 타입을 지정 수 있다. 지정하지 않으면 기본 타입은 ClusterIP이다.


### 서비스의 종류

서비스의 종류는 크게 네 가지로 나뉘어진다.

* ClusterIP : 쿠버네티스 클러스터 내에서 사용 가능한 기본 서비스 타입이다. 클러스터 외부에서는 사용할 수 없다.

* NodePort : 각 노드의 지정된 포트를 할당하는 방식으로, 포트 번호만 서비스에 지정된 것을 사용하면 접근 가능하므로 클러스터 외부에서 사용할 수 있다.

* LoadBalancer : Cloud 서비스를 사용할 때 사용가능한 옵션이다. 포트를 클라우드에서 제공하는 로드밸런서와 연결해 로드밸런서의 IP를 이용하여 외부에서 접근할 수 있다.

* ExternalName : 서비스를 externalName의 값과 매치시킨다. 클러스터 내부에서 외부로 접근할때 주로 사용한다. 이 서비스로 접근하면 클러스터 외부로 접근할 수 있다.


서비스를 만들때 ClusterIP를 None으로 설정하면 ClusterIP가 없는 서비스가 만들어진다. 이런 서비스를 헤드리스 서비스라고 한다.
